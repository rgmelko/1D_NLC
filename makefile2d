CC = nvcc
OBJS = NLC_2D_TFIM.o CPU/GenHam.o CPU/Lanczos_07.o graphs.o GPU/tfising.o GPU/xy.o GPU/heisenberg.o GPU/hamiltonian.o GPU/lanczos.o
#CFLAGS = -O2
CFLAGS = -O2 -gencode arch=compute_20,code=sm_21
HEISLIBS = -LGPU/sort/sort/gnu/release -lmgpusort -lcuda -lcudart
LANCLIBS = -lcublas -lcusparse

2d.out: $(OBJS)
	$(CC) $(CFLAGS) $(OBJS) -o 2d.out $(HEISLIBS) $(LANCLIBS)

NLC_2D_TFIM.o : NLC_2D_TFIM.cu CPU/GenHam.h CPU/Lanczos_07.h CPU/simparam.h graphs.h GPU/lanczos.h
	$(CC) $(CFLAGS) -c NLC_2D_TFIM.cu 

CPU/GenHam.o: CPU/GenHam.cpp CPU/GenHam.h CPU/Lanczos_07.h
	$(CC) $(CFLAGS) -c CPU/GenHam.cpp -o CPU/GenHam.o

CPU/Lanczos_07.o: CPU/Lanczos_07.cpp CPU/GenHam.h CPU/Lanczos_07.h
	$(CC) $(CFLAGS) -c CPU/Lanczos_07.cpp -o CPU/Lanczos_07.o

graphs.o: graphs.cpp graphs.h
	$(CC) $(CFLAGS) -c graphs.cpp

GPU/lanczos.o : GPU/lanczos.cu GPU/lanczos.h 
	$(CC) $(CFLAGS) -c GPU/lanczos.cu $(LANCLIBS) -o GPU/lanczos.o

GPU/hamiltonian.o : GPU/hamiltonian.cu GPU/hamiltonian.h
	$(CC) $(CFLAGS) -c GPU/hamiltonian.cu $(HEISLIBS) -o GPU/hamiltonian.o

GPU/heisenberg.o : GPU/heisenberg.cu GPU/hamiltonian.h
	$(CC) $(CFLAGS) -c GPU/heisenberg.cu -o GPU/heisenberg.o

GPU/xy.o : GPU/xy.cu GPU/hamiltonian.h
	$(CC) $(CFLAGS) -c GPU/xy.cu -o GPU/xy.o

GPU/tfising.o : GPU/tfising.cu GPU/hamiltonian.h
	$(CC) $(CFLAGS) -c GPU/tfising.cu -o GPU/tfising.o

clean :
	rm CPU/*.o && rm *.o && rm GPU/*.o
